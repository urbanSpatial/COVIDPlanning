---
title: "CV19 Grant Funding"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
    theme: default
    mathjax: null
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
library(flexdashboard)
library(shinyWidgets)
library(shiny)
# devtools::install_github("walkerke/bsselectR")
library(bsselectR)
library(stringr)
library(leaflet)
library(kableExtra)
library(sf)
library(tidyverse)
library(htmltools)
library(scales)
library(dataui)
library(reactable)
library(tibble)
library(lubridate)
```

<style>

<!-- All white background -->
body {background-color: #ffffff;}
.tab-content>.dashboard-page-wrapper.active {background-color: #ffffff}

.dashboard-page-wrapper {
  align-items: center;
}

<!-- Text centering -->
h1, .h1, strong, .strong {text-align: center;}
h2 {text-align: center;}
h3 {text-align: center;}
h4 {text-align: center;}

<!-- Dropdown menu -->
<!-- .btn-default:active, .btn-default.active,  -->
<!-- .open>.dropdown-toggle.btn-default, -->
<!-- .btn-default:focus { -->
<!--   background-color: #2780e3; -->
<!-- } -->
.btn-default:active:hover, .btn-default.active:hover, .open>.dropdown-toggle.btn-default:hover, .btn-default:active:focus, .btn-default.active:focus, .open>.dropdown-toggle.btn-default:focus, .btn-default:active.focus, .btn-default.active.focus, .open>.dropdown-toggle.btn-default.focus
 {
  background-color: #2780e3;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
}

.btn-default, .btn-default:active, .btn-default.active, 
.open>.dropdown-toggle.btn-default,
.btn-default:focus, .btn-default:hover
 {
  background-color: #2780e3;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
}
.bootstrap-select.btn-group:not(.input-group-btn), .bootstrap-select.btn-group[class*=col-] {
  margin-left: 0%;
}
.btn-default:active {background-color: #2780e3;}
btn-default:active {background-color: #2780e3;}
.btn-default:visited {background-color: #2780e3;}
btn-default:visited {background-color: #2780e3;}
.btn-default:hover {background-color: #2780e3;}
.dropdown-toggle.btn-default:focus {background-color: #2780e3;}
li.selected.active > a {background-color: #2780e3;}
.dropdown-menu > li > a:focus {background-color: #1967be;}
.dropdown-menu > li > a:hover {background-color: #1967be;}
.dropdown-menu > ul > li.selected.active > a  {background-color: #1967be;}


<!-- leaflet center -->
.html-widget {
    margin: auto;
}
/* constrain leaflet and reactable to screen boundaries */
.reactable, .leaflet-container {
  max-width: 96vw;
  margin: auto;
}
/* make reactable cells even compacter */
.rt-compact .rt-td {
  padding: 0  6px !important;
}
.dataui.html-widget {
  margin: 0px;
}
/* hide auto generated flexdashboard row in overview, county report */
#project-overview .section.level1, #county-reports .section.level1 {
  display: none;
}

iframe {
  padding-top: 75px;
  min-width: 320px; /* should be smallest width modern phone */
}

/* footer styling */
footer {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}

</style>


<script>
function renderTooltip(_ref) {
  var datum = _ref.datum;
  return React.createElement(
      'div',
      null,
      datum.x && React.createElement(
        'div',
        null,
        datum.x
      ),
      React.createElement(
        'div',
        null,
        datum.y ? datum.y.toLocaleString(undefined, {maximumFractionDigits:0}) : '--'
      )
  );
}
</script>

```{r data, include=FALSE}
### NEED ALL THE DATA
repo_dir <- "C:/MicaDL/CV19_Grants/cv19grantmaking"
# all_long_sf_clean <- readr::read_rds(file.path(repo_dir,"/DATA/all_long_sf_clean.rds"))
all_long_sf_clean <- readr::read_rds(file.path(repo_dir,"/DATA/all_long_sf_clean_vars_region.rds")) 
indices_clean3 <- readr::read_rds(file.path(repo_dir,"/DATA/indices_clean3.rds"))
# sparkline.finish  <- readr::read_rds(file.path(repo_dir,"/DATA/needs_summary_JS_table.rds"))
grantmakingData   <- read.csv(file.path(repo_dir,"DATA/7_7_2020_ERFund_geocodes_MDH.csv"),
                     stringsAsFactors = FALSE) 
# Download CV19 data
region.covid <- 
  read.csv("https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv") %>% 
  filter(state %in% c("Pennsylvania", "New Jersey"))
Region_county_outline_sf    <- st_read(file.path(repo_dir,
                                                 "/GEOJSON/Region_county_outline_sf.geojson"))
county_vulnerability_grants <- st_read(file.path(repo_dir,
                                                 "/GEOJSON/county_vulnerability_grants.geojson"))

### Working on a new version for leaflet map, need to join in alignment data
county_vulnerability_grants2 <- indices_clean3 %>% 
  st_drop_geometry() %>% 
  filter(Index == "vulnerability_index") %>% 
  pivot_wider(names_from = Index, values_from = Value) %>% 
  left_join(., filter(indices_clean3, Index == "vulnerability_index") %>% 
               select(GEOID) , by = "GEOID") %>% 
  st_as_sf()

county_vulnerability_grants
counties <- c("Philadelphia", "Montgomery", "Chester", "Delaware", "Bucks", "Camden", "Burlington", "Atlantic", "Cumberland", "Cape May")

```


<!-- Summary Table Creation -->
<!-- # ```{r include=FALSE} -->
<!-- # State  = "Pennsylvania" -->
<!-- # pa.counties <- c("Bucks County", "Montgomery County", "Chester County", "Delaware County","Philadelphia County") -->
<!-- # nj.counties <- c("Camden County","Burlington County","Atlantic County","Cumberland County","Cape May County") -->
<!-- # pa_dat <- filter(all_long_sf_clean, State=="Pennsylvania" & County %in% pa.counties) -->
<!-- # nj_dat <- filter(all_long_sf_clean, State=="New Jersey" & County %in% nj.counties) -->
<!-- # all_dat.sf <- rbind(pa_dat, nj_dat) %>% st_transform(4326)                -->
<!-- # all_dat <- rbind(st_drop_geometry(pa_dat), st_drop_geometry(nj_dat))                  -->
<!-- # ``` -->


Project Overview
=======================================================================

<div style="max-width:1200px; width: 100%; padding: 0 20px;">
<h1 style="font-size:32px;"><strong><center>CV-19 Grantmaking strategic planning analytics (Phase 1)</center></strong></h1>
<h2 style="font-size:24px;"><i>An atlas of COVID-19 era need and philanthropic response in the Delaware Valley Region</i></h2>
<br>
<h4>June, 2020</h4>
<br>
<p style="font-size:18px;">Where have Delaware Valley philanthropies allocated emergency COVID-19 resources, and how do those resources align with need? In this, the first Phase of a larger project, a series of strategic planning analytics have been designed to help stakeholders target future grantmaking where it is most in need.</p>
<br>
<p style="font-size:18px;">Visit County Reports above to investigate the geography of grantmaking and need regionally and by county. Visit the About page for more information on this ongoing project.</p>

<h3>Strategic planning overlay map</h3>
<br>
<p style="font-size:18px;">The goal of the map below is to help stakeholders target future grantmaking. Darker shades of blue show Census tracts where there is more relative need, here defined by a Social Vulnerability index, than relative grantmaking. Stakeholders may wish to invest more in these places. Shades of white indicate alignment between relative need and grantmaking. Darker shades of red are places where grantmaking is in relative excess. See the County Reports section for more in-depth strategic planning analysis.</p>
<br>

```{r fig.width=800, fig.height=500}
pal <- colorNumeric("RdBu", NULL)

county_outline <- as(Region_county_outline_sf, "Spatial")
county_outline <- as(county_outline, "SpatialLines")

leaflet(height = 550, width = 800) %>%
  addProviderTiles(providers$CartoDB.Positron) %>% 
  setView(-75.1652, 39.9526, zoom = 9) %>% 
  addPolygons(data = county_vulnerability_grants,
              stroke = FALSE, 
              smoothFactor = 0.3, 
              fillOpacity = 0.8,
              fillColor = ~pal(alignment),
              popup = ~paste0(County,"<br>",
                    "GEOID: ", GEOID, "<br>",
                    "Alignment: ", alignment),
              group = "Vulnerability") %>%
    addPolylines(data = county_outline, 
                 stroke = TRUE, 
                 color = "black",
                 opacity = 1,
                 weight = 1,
                 fillOpacity = 0,
                 group = "Counties"
  ) %>% 
  addLayersControl(
    overlayGroups = c("Counties", "Vulnerability"),
    options = layersControlOptions(collapsed = FALSE)
  ) %>% 
  addLegend(values = county_vulnerability_grants$alignment, 
            group = "Vulnerability", 
            position = "bottomleft", 
            # pal = pal, 
            colors =c("#CA0020", "#F4A582", "#F7F7F7", "#92C5DE", "#0571B0"),
            labels= c("Sufficient Granting", "","Well Aligned","", "Excess Need"),
            title = "Vulnerability")
```


<br>


```{r}
h3("County grantmaking and need statistics")

### Commented out old table
# formattable::format_table(sparkline.finish, 
#   align =c("l","c","c","c","c","c","c","c"),
#   list(
#     Number=color_bar("#F1A587"),
#     Dollars=color_bar("#F3C0AC"),
#     Housing_Instability=color_bar("#8BBCD9"),
#     Social_Vulnerability=color_bar("#AFD0E3"))) %>%
#   
#   kable_styling("striped", full_width = F, bootstrap_options = c("striped", "hover", "condensed")) %>%
#     add_header_above(c(" " = 1, "Total Granting" = 2, "Average Need" = 2, "Distribution of Need & Resources" = 3),
#      color="grey") %>%
#     column_spec(1, bold = T, border_right = T) %>%
#     column_spec(3, border_right = T) %>%
#     column_spec(5, border_right = T) %>%
#     column_spec(8, border_right = T) %>%
#   htmltools::HTML() %>%
#   shiny::div() %>%
#   sparkline::spk_add_deps()

#### ALL THE DATA MUNGING FOR THE NEW TABLE
### summarise population by county
county_pop <- all_long_sf_clean %>% 
  filter(Variable == "pop") %>% 
  st_drop_geometry() %>% 
  group_by(County) %>% 
  summarise(population = sum(Value, na.rm = TRUE)) %>% 
  mutate(County = str_remove(County, " County"))

### Create cumulative and per capita CV19 metrics
region.covid2 <- region.covid %>% 
  mutate(state_county = paste0(state,",",county)) %>% 
  filter(county %in% counties) %>% 
  filter(state_county != "Pennsylvania,Cumberland") %>% 
  arrange(county, date) %>%
  group_by(county) %>% 
  mutate(previous.cases  = lag(cases, order_by=date, default = 0),
         New.Cases       = cases - previous.cases,
         New.Cases       = ifelse(New.Cases < 0, 0, New.Cases),
         cases_cume      = cumsum(New.Cases),
         previous.deaths = lag(deaths, order_by=date, default = 0),
         New.Deaths       = deaths - previous.deaths,
         New.Deaths       = ifelse(New.Deaths < 0, 0, New.Deaths),
         deaths_cume      = cumsum(New.Deaths),
         Day_of_the_year = yday(date)) %>% 
  arrange(county) %>%
  rename(County = county) %>%
  ungroup() %>% 
  mutate(County = as.character(County))
  
### Summarise CV19 metrics by county
region.covid_sum <- region.covid2 %>% 
  group_by(County) %>% 
  summarise(total_cases = max(cases_cume),
            total_deaths = max(deaths_cume)) %>% 
  left_join(county_pop, by = "County") %>% 
  mutate(cases_pc  = total_cases / population,
         deaths_pc = total_deaths / population,
         cases_p1000c  = total_cases / (population/1000),
         deaths_p1000c = total_deaths / (population/1000)) %>% 
  arrange(County)
  
### Munge indices
Index_dat <- indices_clean3 %>% 
  st_drop_geometry() %>% 
  filter(Index %in% c("housing_index", "vulnerability_index")) %>% 
  pivot_wider(names_from = Index, values_from = Value) %>% 
  mutate(County = str_remove(County, " County")) %>% 
  arrange(County)

Index_sum <- Index_dat %>% 
  group_by(County) %>% 
  summarise(mean_housing_index = mean(housing_index, na.rm=TRUE),
            mean_vuln_index    = mean(vulnerability_index, na.rm=TRUE)) %>% 
  ungroup() %>% 
  arrange(County)

### Munge grants data
County_Grant_Sum <- grantmakingData %>% 
  group_by(County) %>% 
  summarise(total_grants = n(),
            total_grant_dollars = sum(amountAwarded)) %>% 
  rbind(., data.frame(County = c("Cape May", "Cumberland"),
                      total_grants = c(0,0),
                      total_grant_dollars = c(0,0))) %>% 
  mutate(County = str_remove(County, " County")) %>% 
  left_join(county_pop, by = "County") %>% 
  mutate(grant_dollars_pc = total_grant_dollars / population,
         grant_dollars_p1000c = total_grant_dollars / (population/1000)) %>% 
  arrange(County)

grantmakingData_full <- grantmakingData %>% 
  select(County, amountAwarded) %>% 
  mutate(County = str_remove(County, " County")) %>% 
  rbind(., data.frame(County = c("Cape May", "Cumberland"),
                      amountAwarded = c(0,0))) %>% 
  arrange(County)

#plot
# region.covid2 %>%
#   ggplot(aes(as.Date(date), cases_cume)) +
#   geom_bar(stat="identity" , fill="black") +
#   theme(legend.position = "none") +
#   facet_wrap(~county)

ncounty <- length(counties)

create_data_hist <- function(dat = NULL, alldat=NULL, ...) {
  h_all <- hist(alldat, plot = FALSE, ...)
  h_dat <- hist(dat, breaks = h_all$breaks, plot=FALSE)
  list(
    h_all = unclass(h_all),
    h_dat = unclass(h_dat)
  )
}

split_tibble <- function(tibble, column = "County") {
  tibble %>% 
    split(., .[,column]) %>% 
    lapply(., function(x) na.omit(x[,setdiff(names(x),column), drop = TRUE]))
}

df <- tibble(
  county = sort(counties),
  cases_per_capita = round(region.covid_sum$cases_p1000c,2),
  deaths_per_capita = round(region.covid_sum$deaths_p1000c,2),
  cases_over_time = split_tibble(region.covid2 %>% select(County, cases_cume)),
  num_grants = County_Grant_Sum$total_grants,
  dollar_grants = County_Grant_Sum$total_grant_dollars,
  dollar_grants_per_capita = County_Grant_Sum$grant_dollars_pc,
  avg_housing_instability  = round(Index_sum$mean_housing_index),
  avg_social_vulnerability = round(Index_sum$mean_vuln_index),
) %>%
  mutate(
    n = row_number(),
    grant_data = split_tibble(grantmakingData_full),
    grant_hist = lapply(
      grant_data,
      function(dat) create_data_hist(dat = dat,alldat = unlist(grant_data))
    ),
    instability_data = split_tibble(Index_dat %>% select(County, housing_index)),
    instability_hist = lapply(
      instability_data,
      function(dat) create_data_hist(dat = dat,alldat = unlist(instability_data))
    ),
    vulnerability_data = split_tibble(Index_dat %>% select(County, vulnerability_index)),
    vulnerability_hist = lapply(
      vulnerability_data,
      function(dat) create_data_hist(dat = dat,alldat = unlist(vulnerability_data))
    )
  )

rt1 <- df %>%
  select(-n, -contains("_data")) %>%
  reactable(
    pagination = FALSE,
    rowStyle = "align-items: center; font-size:120%; line-height:50px;",
    borderless = TRUE,
    striped = TRUE,
    compact = TRUE,
    defaultColDef = colDef(
      headerStyle = list( display = "flex", flexDirection= "column", justifyContent= "flex-end", textAlign = "center"),
      sortable = FALSE
    ),
    columnGroups = list(
      colGroup( name = "COVID-19", columns = c("cases_per_capita","deaths_per_capita","cases_over_time") ),
      colGroup( name = "Average Need", columns = c("avg_housing_instability", "avg_social_vulnerability")),
      colGroup( name = "Distribution of Needs and Resources", columns = tail(colnames(.),3))
    ),
    columns = list(
      county = colDef(
        name = "County", sortable = TRUE, minWidth = 120, maxWidth = 140,
        style = "border-right: 2px solid #e6e6e6;"
      ),
      cases_per_capita = colDef(
        name = "Cases Per 1000 Pop",
        sortable = TRUE,
        maxWidth = 80,
      ),
      deaths_per_capita = colDef(
        name = "Deaths Per 1000 Pop",
        sortable = TRUE,
        maxWidth = 75,
      ),
      cases_over_time = {colDef(
        name = "Cases Over Time",
        style = "border-right: 2px solid #e6e6e6; height: 50px;",
        minWidth = 150,
        maxWidth = 150,
        cell = dui_for_reactable(
          {dui_sparkline(
            data = htmlwidgets::JS("cellInfo.value"),
            height = 40,
            width = 135,
            margin = list(top = 8, right = 6, bottom = 0, left = 10),
            renderTooltip = htmlwidgets::JS("
              function(_ref) {
                var datum = _ref.datum;
                return React.createElement(
                    'div',
                    null,
                    datum.x && React.createElement(
                      'div',
                      null,
                      datum.x
                    ),
                    React.createElement(
                      'div',
                      null,
                      datum.y ? datum.y.toLocaleString(undefined, {maximumFractionDigits:0}) : '--'
                    )
                );
              }
            "),
            components = list(
              dui_sparklineseries(
                showArea = TRUE,
                stroke = "#91a7ff",
                fill = "#91a7ff"
              ),
              dui_sparkpointseries(
                points = list("last"),
                stroke = "rgb(92, 124, 250)",
                fill = "#fff",
                size = 3,
                labelPosition = "left",
                labelOffset = "10",
                renderLabel = htmlwidgets::JS("function(d) {return d.toLocaleString(undefined, {maximumFractionDigits:0})}")
              ),
              dui_tooltip(
                components = list(
                  dui_sparkverticalrefline(key="ref-vertical",strokeWidth=1, strokeDasharray="4 4"),
                  dui_sparkpointseries(
                    key="ref-point",
                    fill="#91a7ff"
                  )#,
                )
              )
            )
          )}
        )
      )},
num_grants = {colDef(
  name = "Number of Grants",
  sortable = TRUE,
  format = colFormat(separators = TRUE, digits = 0),
  maxWidth = 90,
)},
dollar_grants = {colDef(
  name = "Total Grant Dollars",
  sortable = TRUE,
  format = colFormat(prefix = "$", separators = TRUE, digits = 0),
  maxWidth = 100,
)},
dollar_grants_per_capita = {colDef(
  name = "Grant Dollars Per Capita",
  sortable = TRUE,
  format = colFormat(prefix = "$", separators = TRUE, digits = 2),
  maxWidth = 90
)},
avg_housing_instability = {colDef(
  name = "Average Housing Instability",
  sortable = TRUE,
  maxWidth = 90,
  align = "center"
)},
avg_social_vulnerability = {colDef(
  name = "Average Social Vulnerability",
  sortable = TRUE,
  maxWidth = 100,
  style = "border-right: 2px solid #e6e6e6;",
  align = "center"
)},
grant_hist = {colDef(
  name = "Histogram of Grants by Grant Dollars (R)",
  align = "center",
  minWidth = 100,
  maxWidth = 100,
  cell = function(value, index) {
    dui_histogram(
      height = 40,
      width = 100,
      margin = list(top = 0, right = 6, bottom = 0, left = 6),
      components = list(
        dui_barseries(binnedData = hist_to_binned_data(value$h_dat), animated = FALSE)
      )
    )
  }
)},
instability_hist = {colDef(
  name = "Histogram of Housing Instability (R)",
  align = "center",
  minWidth = 100,
  maxWidth = 100,
  cell = function(value, index) {
    dui_histogram(
      height = 40,
      width = 100,
      margin = list(top = 0, right = 6, bottom = 0, left = 6),
      components = list(
        dui_barseries(binnedData = hist_to_binned_data(value$h_dat), animated = FALSE, fill = "#20c997")
      )
    )
  }
)},
vulnerability_hist = {colDef(
  name = "Histogram of Social Vulnerability (R)",
  align = "center",
  minWidth = 100,
  maxWidth = 100,
  cell = function(value, index) {
    dui_histogram(
      height = 40,
      width = 100,
      margin = list(top = 0, right = 6, bottom = 0, left = 6),
      components = list(
        dui_barseries(binnedData = hist_to_binned_data(value$h_dat), animated = FALSE, fill="#be4bdb")
      )
    )
  }
)}
    )
)


rt1 %>% dui_add_reactable_dep()

```

<footer>
<p style="font-size:18px;"> This work was supported by a coalition philanthropic organizations in the Delaware Valley Region and created by the below entities. </p>
<center>
  <img style="margin-top: 1.5em;max-width:96vw;" src="./IMAGES/3logos_ERproject.png" width="600">
</center>
</footer>

</div>

County Reports {data-icon="fa-map"}
=======================================================================

<h3>County Level Analysis</h3>

<div style="max-width:1200px; width: 100%; padding: 0 20px;">

```{r}
county_plots <- c("./REPORTS/Regional.html", "./REPORTS/Atlantic_County.html",
                  "./REPORTS/Bucks_County.html",
                  "./REPORTS/Burlington_County.html", "./REPORTS/Camden_County.html",
                  "./REPORTS/Delaware_County.html", "./REPORTS/Montgomery_County.html", "./REPORTS/Philadelphia_County.html")
names(county_plots) <- str_replace_all(county_plots,
                                      c("\\.html" = "",
                                        "./REPORTS/" = "",
                                        "_" = " "))

# note this only support iframe
bsselect_buildTags <- function(
  choices,
  selected = NULL,
  dropdownAlignRight = FALSE,
  dropupAuto = TRUE,
  header = FALSE,
  liveSearch = FALSE,
  boxWidth = FALSE,
  liveSearchStyle = c("contains", "startsWith"),
  showTick = FALSE,
  size = "auto",
  style = NULL,
  selectWidth = "20%",
  frameHeight = NULL,
  frameWidth = "80%",
  elementId = NULL
) {
  l <- function(x) return(tolower(as.character(x)))
  if (is.null(selected)) {
      sel <- choices[1]
  }
  else {
      index <- match(selected, names(choices))
      sel <- choices[index]
  }
  liveSearchStyle = match.arg(liveSearchStyle, c("contains", "startsWith"))
  tagList(
    # get necessary dependencies minus htmlwidgets.js and bsselect widget binding
    htmlwidgets::getDependency("bsselect", package="bsselectR")[2],
    tags$div(
      style = "width: 100%;",
      tags$div(
        style = paste0("width:", selectWidth,"; float: left; padding-left:20px;"),
        tags$select(
          id = paste0(elementId,"-select"),
          class = "selectpicker",
          `data-dropdown-align-right` = l(dropdownAlignRight),
          `data-dropup-auto` = l(dropupAuto), `data-header` = l(header),
          `data-live-search` = l(liveSearch), `data-live-search-style` = liveSearchStyle,
          `data-show-tick` = l(showTick), `data-width` = l(boxWidth),
          `data-size` = l(size), `data-style` = style,
          bsselectR:::selectOptions(choices, selected)
        )
      ),
      tags$iframe(
        id = paste0(elementId,"-iframe"),
        src  = sel,
        frameborder = "0",
        style = paste0("height:", frameHeight, "; width:", frameWidth,"; float: left;")
      )
    ),
    tags$script(htmltools::HTML(sprintf(
"
$(document).ready(function() {
$('#%s').change(function() {
$('#%s').attr('src', $(this).val())
})
})
",
paste0(elementId,"-select"),
paste0(elementId,"-iframe")
    )))
  )
}

# potentially better to create directly or deconstruct
# bsselect(county_plots,
#          frame_height = NULL,
#          type = "iframe",
#          selected = "Regional",
#          elementId = "dropdown",
#          live_search = TRUE,
#          show_tick = TRUE)

# use our new function instead; note camelCase not snakecase
bsselect_buildTags(county_plots,
         selectWidth = "20%",
         frameHeight = "calc(100vh - 150px)",
         frameWidth = "75%",
         #type = "iframe", #only support iframe
         selected = "Regional",
         elementId = "dropdown",
         liveSearch = TRUE,
         showTick = TRUE)
```

</div>

About 
=======================================================================

<div style="max-width:1200px; width: 100%; padding: 0 20px;">
<h3>About this project</h3>
<br>
<p style="font-size:18px;">The purpose of this Phase 1 COVID-19 regional data dashboard is to support a more informed and coordinated, regional response among philanthropic funders by providing information on: What the needs are for philanthropic funding, where that need is, who is receiving aid, how & when major relief funds are responding.</p>
<br>
<p style="font-size:18px;">The grants data that appears on this page comes from a host of philanthropies who reported the address, domain of interest and other information for their COVID-19 grantmaking activities. We were able to successfully georeference 90% of these grants. The remainder of the data used was collected from a host of Federal sources (see table below).</p?
<br>
<p style="font-size:18px;">Phase 2 will increase the number of grants in the analysis. We are also developing a more robust and interactive set of planning and mapping tools for this project. Stay tuned!</p>
<br>


Row 
-------------------------------------

### tables{.no-title}

```{r}
h3("Data Sources")

Theme <- c('Housing','Demographics','Employment','Food Insecurity','Child Welfare','Health')
Source <- c('American Community Survey (ACS),\n Homeland Infrastructure Foundation-Level Data (HIFLD)', 'ACS,\nHIFLD',
            'LODES/LEHD,\nBLS Unemployment','ACS,\nUSDA Food Atlas',
            'ACS,\n HIFLD','ACS,\nHIFLD'
            )
Year <- c('2014-2018,\n2019','2014-2018,\n2019','2015,\n2020', '2014-2018,\n2015','2014-2018,\n2019','2014-2018,\n2019')
Link <- c('https://data.census.gov/cedsci/,\n https://gii.dhs.gov/hifld/content/hifld-data-catalog',
          'https://data.census.gov/cedsci/,\n https://gii.dhs.gov/hifld/content/hifld-data-catalog',
          'https://lehd.ces.census.gov/data/, https://www.bls.gov/cew/',
          'https://data.census.gov/cedsci/,
          https://www.ers.usda.gov/data-products/food-access-research-atlas/download-the-data/',
          'https://data.census.gov/cedsci/,\n https://gii.dhs.gov/hifld/content/hifld-data-catalog',
          'https://data.census.gov/cedsci/,\n https://gii.dhs.gov/hifld/content/hifld-data-catalog'
          )
sources <- data.frame(Theme,Source,Year, Link)

kable(sources) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed")) %>%
  column_spec(1, width="3cm", border_right = T) %>%
  column_spec(3, width="3cm", border_right = T) 

```

<footer>
<p style="font-size:18px;"> This work was supported by a coalition philanthropic organizations in the Delaware Valley Region and created by the below entities. </p>
<center>
  <img style="margin-top: 1.5em;max-width:96vw;" src="./IMAGES/3logos_ERproject.png" width="600">
</center>
</footer>


</div>
